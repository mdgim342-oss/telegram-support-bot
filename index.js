const express = require('express');
const { Telegraf } = require('telegraf');
const app = express();

// à¦à¦¨à¦­à¦¾à¦¯à¦¼à¦°à¦¨à¦®à§‡à¦¨à§à¦Ÿ à¦­à§‡à¦°à¦¿à¦¯à¦¼à§‡à¦¬à¦²
const BOT_TOKEN = process.env.BOT_TOKEN;
const SUPPORT_GROUP = "https://t.me/+pT5CQm1MGag1OWM1";
const PORT = process.env.PORT || 3000;

// à¦¬à¦Ÿ à¦‡à¦¨à¦¿à¦¶à¦¿à¦¯à¦¼à¦¾à¦²à¦¾à¦‡à¦œ
const bot = new Telegraf(BOT_TOKEN);

// à¦à¦•à§à¦¸à¦ªà§à¦°à§‡à¦¸ à¦®à¦¿à¦¡à¦²à¦“à¦¯à¦¼à§à¦¯à¦¾à¦°
app.use(express.json());

// à¦¹à§‡à¦²à¦¥ à¦šà§‡à¦•
app.get('/', (req, res) => {
  res.send('à¦¬à¦Ÿ à¦šà¦²à¦›à§‡');
});

// à¦“à¦¯à¦¼à§‡à¦¬à¦¹à§à¦• à¦à¦¨à§à¦¡à¦ªà¦¯à¦¼à§‡à¦¨à§à¦Ÿ
app.post(`/webhook/${BOT_TOKEN}`, (req, res) => {
  bot.handleUpdate(req.body, res);
});

// à¦¸à¦²à¦¿à¦‰à¦¶à¦¨ à¦²à¦¿à¦¸à§à¦Ÿ
const solutions = {
  login: `ðŸ” **à¦²à¦—à¦‡à¦¨ à¦¸à¦®à¦¸à§à¦¯à¦¾à¦° à¦¸à¦®à¦¾à¦§à¦¾à¦¨**

à§§. à¦†à¦ªà¦¨à¦¾à¦° à¦‡à¦¨à§à¦Ÿà¦¾à¦°à¦¨à§‡à¦Ÿ à¦¸à¦‚à¦¯à§‹à¦— à¦šà§‡à¦• à¦•à¦°à§à¦¨
à§¨. à¦…à§à¦¯à¦¾à¦ªà§‡à¦° à¦•à§à¦¯à¦¾à¦¶à§‡ à¦•à§à¦²à¦¿à¦¯à¦¼à¦¾à¦° à¦•à¦°à§à¦¨
à§©. à¦ªà¦¾à¦¸à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦°à¦¿à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨
à§ª. à¦Ÿà§‡à¦²à¦¿à¦—à§à¦°à¦¾à¦® à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à§à¦¨

à¦¸à¦®à¦¾à¦§à¦¾à¦¨ à¦¨à¦¾ à¦¹à¦²à§‡ à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦—à§à¦°à§à¦ªà§‡ à¦œà¦¯à¦¼à§‡à¦¨ à¦•à¦°à§à¦¨à¥¤`,

  payment: `ðŸ’° **à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾à¦° à¦¸à¦®à¦¾à¦§à¦¾à¦¨**

à§§. à¦†à¦ªà¦¨à¦¾à¦° à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦šà§‡à¦• à¦•à¦°à§à¦¨
à§¨. à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦®à§‡à¦¥à¦¡ à¦­à§‡à¦°à¦¿à¦«à¦¾à¦‡ à¦•à¦°à§à¦¨
à§©. à§§à§¦-à§§à§« à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦…à¦ªà§‡à¦•à§à¦·à¦¾ à¦•à¦°à§à¦¨
à§ª. à¦¬à§à¦¯à¦¾à¦‚à¦•à§‡ à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨

à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦¦à¦°à¦•à¦¾à¦°? à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦—à§à¦°à§à¦ªà§‡ à¦œà¦¯à¦¼à§‡à¦¨ à¦•à¦°à§à¦¨à¥¤`,

  technical: `âš™ï¸ **à¦Ÿà§‡à¦•à¦¨à¦¿à¦•à§à¦¯à¦¾à¦² à¦¸à¦®à¦¸à§à¦¯à¦¾à¦° à¦¸à¦®à¦¾à¦§à¦¾à¦¨**

à§§. à¦…à§à¦¯à¦¾à¦ª à¦°à¦¿à¦¸à§à¦Ÿà¦¾à¦°à§à¦Ÿ à¦•à¦°à§à¦¨
à§¨. à¦•à§à¦¯à¦¾à¦¶à§‡ à¦•à§à¦²à¦¿à¦¯à¦¼à¦¾à¦° à¦•à¦°à§à¦¨
à§©. à¦…à§à¦¯à¦¾à¦ª à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à§à¦¨
à§ª. à¦«à§‹à¦¨ à¦°à¦¿à¦¸à§à¦Ÿà¦¾à¦°à§à¦Ÿ à¦•à¦°à§à¦¨

à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¥à¦¾à¦•à¦²à§‡ à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦—à§à¦°à§à¦ªà§‡ à¦œà¦¯à¦¼à§‡à¦¨ à¦•à¦°à§à¦¨à¥¤`,

  account: `ðŸ‘¤ **à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾à¦° à¦¸à¦®à¦¾à¦§à¦¾à¦¨**

à§§. à¦¸à§‡à¦Ÿà¦¿à¦‚à¦¸à§‡ à¦¯à¦¾à¦¨
à§¨. à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦² à¦à¦¡à¦¿à¦Ÿ à¦•à¦°à§à¦¨
à§©. à¦¤à¦¥à§à¦¯ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à§à¦¨
à§ª. à¦¸à§‡à¦­ à¦•à¦°à§à¦¨

à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦¦à¦°à¦•à¦¾à¦°? à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦—à§à¦°à§à¦ªà§‡ à¦œà¦¯à¦¼à§‡à¦¨ à¦•à¦°à§à¦¨à¥¤`,

  default: `ðŸ¤– **à¦†à¦®à¦¾à¦° à¦‰à¦¤à§à¦¤à¦° à¦¦à¦¿à¦¤à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à¦šà§à¦›à§‡**

à¦¦à¦¯à¦¼à¦¾ à¦•à¦°à§‡ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦—à§à¦°à§à¦ªà§‡ à¦œà¦¯à¦¼à§‡à¦¨ à¦•à¦°à§à¦¨:
${SUPPORT_GROUP}

à¦¸à§‡à¦–à¦¾à¦¨à§‡ à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦Ÿà¦¿à¦® à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¬à§‡à¥¤`
};

// à¦¸à§à¦Ÿà¦¾à¦°à§à¦Ÿ à¦•à¦®à¦¾à¦¨à§à¦¡
bot.start((ctx) => {
  ctx.reply(
    `ðŸ‘‹ **à¦¸à§à¦¬à¦¾à¦—à¦¤à¦® ${ctx.from.first_name}!**

à¦†à¦®à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦…à§à¦¯à¦¾à¦¸à¦¿à¦¸à§à¦Ÿà§à¦¯à¦¾à¦¨à§à¦Ÿà¥¤ à¦¨à¦¿à¦šà§‡à¦° à¦¯à§‡à¦•à§‹à¦¨à§‹ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨:

ðŸ” à¦²à¦—à¦‡à¦¨ à¦¸à¦®à¦¸à§à¦¯à¦¾
ðŸ’° à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾
âš™ï¸ à¦Ÿà§‡à¦•à¦¨à¦¿à¦•à§à¦¯à¦¾à¦² à¦¸à¦®à¦¸à§à¦¯à¦¾
ðŸ‘¤ à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾

à¦…à¦¥à¦¬à¦¾ à¦¸à¦°à¦¾à¦¸à¦°à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨à¥¤`
  );
});

// à¦¹à§‡à¦²à§à¦ª à¦•à¦®à¦¾à¦¨à§à¦¡
bot.help((ctx) => {
  ctx.reply(
    `ðŸ“ **à¦¯à§‡à¦­à¦¾à¦¬à§‡ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¬à§‡à¦¨:**

â€¢ à¦²à¦—à¦‡à¦¨ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨
â€¢ à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨
â€¢ à¦Ÿà§‡à¦•à¦¨à¦¿à¦•à§à¦¯à¦¾à¦² à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨
â€¢ à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦²à¦¿à¦–à§à¦¨

à¦†à¦®à¦¿ à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦¸à¦®à¦¾à¦§à¦¾à¦¨ à¦¦à§‡à¦¬à¥¤`
  );
});

// à¦®à§‡à¦¸à§‡à¦œ à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à¦²à¦¾à¦°
bot.on('text', (ctx) => {
  const text = ctx.message.text.toLowerCase();
  
  // à¦²à¦—à¦‡à¦¨ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦šà§‡à¦•
  if (text.includes('à¦²à¦—à¦‡à¦¨') || text.includes('login') || text.includes('à¦ªà¦¾à¦¸à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡') || text.includes('password') || text.includes('à¦¸à¦¾à¦‡à¦¨à¦‡à¦¨') || text.includes('signin')) {
    return ctx.reply(solutions.login);
  }
  
  // à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦šà§‡à¦•
  if (text.includes('à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ') || text.includes('payment') || text.includes('à¦Ÿà¦¾à¦•à¦¾') || text.includes('money') || text.includes('à¦¬à¦¿à¦•à¦¾à¦¶') || text.includes('bkash') || text.includes('à¦¨à¦—à¦¦') || text.includes('nagad')) {
    return ctx.reply(solutions.payment);
  }
  
  // à¦Ÿà§‡à¦•à¦¨à¦¿à¦•à§à¦¯à¦¾à¦² à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦šà§‡à¦•
  if (text.includes('à¦Ÿà§‡à¦•à¦¨à¦¿à¦•à§à¦¯à¦¾à¦²') || text.includes('technical') || text.includes('à¦à¦°à¦°') || text.includes('error') || text.includes('à¦¸à¦®à¦¸à§à¦¯à¦¾') || text.includes('problem') || text.includes('à¦‡à¦¸à§à¦¯à§') || text.includes('issue')) {
    return ctx.reply(solutions.technical);
  }
  
  // à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦šà§‡à¦•
  if (text.includes('à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ') || text.includes('account') || text.includes('à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦²') || text.includes('profile') || text.includes('à¦¸à§‡à¦Ÿà¦¿à¦‚') || text.includes('setting')) {
    return ctx.reply(solutions.account);
  }
  
  // à¦•à§‹à¦¨ à¦•à¦¿à¦›à§ à¦¨à¦¾ à¦®à¦¿à¦²à¦²à§‡ à¦¡à¦¿à¦«à¦²à§à¦Ÿ à¦‰à¦¤à§à¦¤à¦°
  ctx.reply(solutions.default);
});

// à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦šà¦¾à¦²à§
app.listen(PORT, () => {
  console.log(`âœ… à¦¬à¦Ÿ à¦šà¦²à¦›à§‡ à¦ªà§‹à¦°à§à¦Ÿ ${PORT} à¦`);
});

// à¦—à§à¦°à§‡à¦¸à¦«à§à¦² à¦¶à¦¾à¦Ÿà¦¡à¦¾à¦‰à¦¨
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
